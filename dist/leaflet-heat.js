"use strict";function simpleheat(t){if(!(this instanceof simpleheat))return new simpleheat(t);this._canvas=t="string"==typeof t?document.getElementById(t):t,this._ctx=t.getContext("2d"),this._width=t.width,this._height=t.height,this._sorted=!1,this._options=this.defaultOptions,this._data=[]}"undefined"!=typeof module&&(module.exports=simpleheat),simpleheat.prototype={defaultGradient:{"0.0":"rgba(204, 0, 0, 1)",.25:"rgba(255, 178, 0, 0.75)",.5:"rgba(0, 243, 255, 0.25)",.75:"rgba(180, 255, 0, 0.75)","1.0":"rgba(0, 214, 96, 1)"},data:function(t){return this._data=t,this._sorted=!1,this},add:function(t){return this._data.push(t),this._sorted=!1,this},clear:function(){return this._data=[],this},defaultOptions:{blendMode:"overlay",max:1,radius:25,blur:15,gradient:{"0.0":"rgba(204, 0, 0, 1)",.25:"rgba(255, 178, 0, 0.75)",.5:"rgba(0, 243, 255, 0.25)",.75:"rgba(180, 255, 0, 0.75)","1.0":"rgba(0, 214, 96, 1)"},colorize:!0,grayscale:{negative:"#000000",neutral:"#808080",positive:"#FFFFFF"}},setOptions:function(t){return this._options=Object.assign({},this._options,t),delete this._circles,delete this._grad,this},getOptions:function(){return Object.assign({},this._options)},initializeCircleBrushes:function(){var t=this._options.grayscale;this._circles={};var i=this._r=this._options.radius+this._options.blur;for(var a in t){var s=t[a],e=this._circles[a]=this._createCanvas(),n=e.getContext("2d");e.width=e.height=2*i,n.shadowOffsetX=n.shadowOffsetY=2*i,n.fillStyle=s,n.shadowColor=s,n.shadowBlur=this._options.blur,n.beginPath(),n.arc(-i,-i,this._options.radius,0,2*Math.PI,!0),n.closePath(),n.fill()}},resize:function(){this._width=this._canvas.width,this._height=this._canvas.height},initializeGradient:function(){var t=this._createCanvas(),i=t.getContext("2d"),a=i.createLinearGradient(0,0,0,256);t.width=1,t.height=256;for(var s in this._options.gradient)a.addColorStop(+s,this._options.gradient[s]);return i.fillStyle=a,i.fillRect(0,0,1,256),this._grad=i.getImageData(0,0,1,256).data,this},draw:function(t){this._circles||this.initializeCircleBrushes(this.defaultRadius),this._grad||this.initializeGradient(),this._sorted||(this._data.sort(function(t,i){return t[3]-i[3]}),this._sorted=!0);var i=this._ctx;i.globalCompositeOperation=this._options.blendMode,i.clearRect(0,0,this._width,this._height);for(var a,s=this._circles.negative,e=this._circles.neutral,n=this._circles.positive,h=0,o=this._data.length;h<o;h++){a=this._data[h],i.globalAlpha=Math.max(a[2]/this._options.max,void 0===t?.05:t);var r=a[3]>0?n:a[3]<0?s:e;i.drawImage(r,a[0]-this._r,a[1]-this._r)}var _=i.getImageData(0,0,this._width,this._height);return this._colorize(_.data,this._grad),i.putImageData(_,0,0),this},_colorize:function(t,i){if(this._options.colorize)for(var a,s=0,e=t.length;s<e;s+=4){var n=t[s+3];n&&(a=4*t[s],t[s]=i[a],t[s+1]=i[a+1],t[s+2]=i[a+2],t[s+3]=Math.floor(i[a+3]/256*(n/256)*256))}},_createCanvas:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}},L.HeatLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(t,i){this._latlngs=t,L.setOptions(this,i)},setLatLngs:function(t){return this._latlngs=t,this.redraw()},addLatLng:function(t){return this._latlngs.push(t),this.redraw()},setOptions:function(t){return L.setOptions(this,t),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return this._heat&&!this._frame&&this._map&&!this._map._animating&&(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),this.options.pane?this.getPane().appendChild(this._canvas):t._panes.overlayPane.appendChild(this._canvas),t.on("moveend",this._reset,this),t.options.zoomAnimation&&L.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){this.options.pane?this.getPane().removeChild(this._canvas):t.getPanes().overlayPane.removeChild(this._canvas),t.off("moveend",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){var t=this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),i=L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);t.style[i]="50% 50%";var a=this._map.getSize();t.width=a.x,t.height=a.y;var s=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(t,"leaflet-zoom-"+(s?"animated":"hide")),this._heat=simpleheat(t),this._updateOptions()},_updateOptions:function(){console.log(this._heat),this._heat.setOptions(this.options)},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t);var i=this._map.getSize();this._heat._width!==i.x&&(this._canvas.width=this._heat._width=i.x),this._heat._height!==i.y&&(this._canvas.height=this._heat._height=i.y),this._redraw()},_redraw:function(){if(this._map){var t,i,a,s,e,n,h,o,r,_,l=[],d=this._heat._r,c=this._map.getSize(),m=new L.Bounds(L.point([-d,-d]),c.add([d,d])),p=void 0===this.options.max?1:this.options.max,g=void 0===this.options.maxZoom?this._map.getMaxZoom():this.options.maxZoom,u=1/Math.pow(2,Math.max(0,Math.min(g-this._map.getZoom(),12))),f=d/2,v=[],y=this._map._getMapPanePos(),w=y.x%f,x=y.y%f;for(t=0,i=this._latlngs.length;t<i;t++)if(a=this._map.latLngToContainerPoint(this._latlngs[t]),m.contains(a)){e=Math.floor((a.x-w)/f)+2,n=Math.floor((a.y-x)/f)+2;var b=void 0!==this._latlngs[t].alt?this._latlngs[t].alt:void 0!==this._latlngs[t][2]?+this._latlngs[t][2]:1;_=(void 0===this._latlngs[t][3]?1:this._latlngs[t][3])+1,r=b*u,v[n]=v[n]||[],v[n][e]=v[n][e]||[],s=v[n][e][_],s?(s[0]=(s[0]*s[2]+a.x*r)/(s[2]+r),s[1]=(s[1]*s[2]+a.y*r)/(s[2]+r),s[2]+=r):v[n][e][_]=[a.x,a.y,r,_]}for(var t=0,i=v.length;t<i;t++)if(v[t])for(var h=0,o=v[t].length;h<o;h++)if(v[t][h])for(var r=0,O=v[t][h].length;r<O;r++)(s=v[t][h][r])&&l.push([Math.round(s[0]),Math.round(s[1]),Math.min(s[2],p),s[3]-1]);this._heat.data(l).draw(this.options.minOpacity),this._frame=null}},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),a=this._map._getCenterOffset(t.center)._multiplyBy(-i).subtract(this._map._getMapPanePos());L.DomUtil.setTransform?L.DomUtil.setTransform(this._canvas,a,i):this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(a)+" scale("+i+")"}}),L.heatLayer=function(t,i){return new L.HeatLayer(t,i)};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9zaW1wbGVoZWF0L3NpbXBsZWhlYXQuanMiLCJzcmMvSGVhdExheWVyLmpzIl0sIm5hbWVzIjpbInNpbXBsZWhlYXQiLCJjYW52YXMiLCJ0aGlzIiwiX2NhbnZhcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJfY3R4IiwiZ2V0Q29udGV4dCIsIl93aWR0aCIsIndpZHRoIiwiX2hlaWdodCIsImhlaWdodCIsIl9zb3J0ZWQiLCJfb3B0aW9ucyIsImRlZmF1bHRPcHRpb25zIiwiX2RhdGEiLCJtb2R1bGUiLCJleHBvcnRzIiwicHJvdG90eXBlIiwiZGVmYXVsdEdyYWRpZW50IiwiMC4wIiwiMC4yNSIsIjAuNSIsIjAuNzUiLCIxLjAiLCJkYXRhIiwiYWRkIiwicG9pbnQiLCJwdXNoIiwiY2xlYXIiLCJibGVuZE1vZGUiLCJtYXgiLCJyYWRpdXMiLCJibHVyIiwiZ3JhZGllbnQiLCJjb2xvcml6ZSIsImdyYXlzY2FsZSIsIm5lZ2F0aXZlIiwibmV1dHJhbCIsInBvc2l0aXZlIiwic2V0T3B0aW9ucyIsIm9wdGlvbnMiLCJPYmplY3QiLCJhc3NpZ24iLCJfY2lyY2xlcyIsIl9ncmFkIiwiZ2V0T3B0aW9ucyIsImluaXRpYWxpemVDaXJjbGVCcnVzaGVzIiwiY29sb3JzIiwicjIiLCJfciIsImNvbG9yTmFtZSIsImNvbG9yIiwiX2NyZWF0ZUNhbnZhcyIsImN0eCIsInNoYWRvd09mZnNldFgiLCJzaGFkb3dPZmZzZXRZIiwiZmlsbFN0eWxlIiwic2hhZG93Q29sb3IiLCJzaGFkb3dCbHVyIiwiYmVnaW5QYXRoIiwiYXJjIiwiTWF0aCIsIlBJIiwiY2xvc2VQYXRoIiwiZmlsbCIsInJlc2l6ZSIsImluaXRpYWxpemVHcmFkaWVudCIsImNyZWF0ZUxpbmVhckdyYWRpZW50IiwiaSIsImFkZENvbG9yU3RvcCIsImZpbGxSZWN0IiwiZ2V0SW1hZ2VEYXRhIiwiZHJhdyIsIm1pbk9wYWNpdHkiLCJkZWZhdWx0UmFkaXVzIiwic29ydCIsImEiLCJiIiwiZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uIiwiY2xlYXJSZWN0IiwicCIsIm5lZyIsInplcm8iLCJwb3MiLCJsZW4iLCJsZW5ndGgiLCJnbG9iYWxBbHBoYSIsInVuZGVmaW5lZCIsImNpcmNsZSIsImRyYXdJbWFnZSIsImNvbG9yZWQiLCJfY29sb3JpemUiLCJwdXRJbWFnZURhdGEiLCJwaXhlbHMiLCJqIiwiYWxwaGEiLCJmbG9vciIsImNyZWF0ZUVsZW1lbnQiLCJjb25zdHJ1Y3RvciIsIkwiLCJIZWF0TGF5ZXIiLCJMYXllciIsIkNsYXNzIiwiZXh0ZW5kIiwiaW5pdGlhbGl6ZSIsImxhdGxuZ3MiLCJfbGF0bG5ncyIsInNldExhdExuZ3MiLCJyZWRyYXciLCJhZGRMYXRMbmciLCJsYXRsbmciLCJfaGVhdCIsIl91cGRhdGVPcHRpb25zIiwiX2ZyYW1lIiwiX21hcCIsIl9hbmltYXRpbmciLCJVdGlsIiwicmVxdWVzdEFuaW1GcmFtZSIsIl9yZWRyYXciLCJvbkFkZCIsIm1hcCIsIl9pbml0Q2FudmFzIiwicGFuZSIsImdldFBhbmUiLCJhcHBlbmRDaGlsZCIsIl9wYW5lcyIsIm92ZXJsYXlQYW5lIiwib24iLCJfcmVzZXQiLCJ6b29tQW5pbWF0aW9uIiwiQnJvd3NlciIsImFueTNkIiwiX2FuaW1hdGVab29tIiwib25SZW1vdmUiLCJyZW1vdmVDaGlsZCIsImdldFBhbmVzIiwib2ZmIiwiYWRkVG8iLCJhZGRMYXllciIsIkRvbVV0aWwiLCJjcmVhdGUiLCJvcmlnaW5Qcm9wIiwidGVzdFByb3AiLCJzdHlsZSIsInNpemUiLCJnZXRTaXplIiwieCIsInkiLCJhbmltYXRlZCIsImFkZENsYXNzIiwiY29uc29sZSIsImxvZyIsInRvcExlZnQiLCJjb250YWluZXJQb2ludFRvTGF5ZXJQb2ludCIsInNldFBvc2l0aW9uIiwiY2VsbCIsImxlbjIiLCJrIiwibGF5ZXIiLCJyIiwiYm91bmRzIiwiQm91bmRzIiwibWF4Wm9vbSIsImdldE1heFpvb20iLCJ2IiwicG93IiwibWluIiwiZ2V0Wm9vbSIsImNlbGxTaXplIiwiZ3JpZCIsInBhbmVQb3MiLCJfZ2V0TWFwUGFuZVBvcyIsIm9mZnNldFgiLCJvZmZzZXRZIiwibGF0TG5nVG9Db250YWluZXJQb2ludCIsImNvbnRhaW5zIiwiYWx0IiwibGVuMyIsInJvdW5kIiwiZSIsInNjYWxlIiwiZ2V0Wm9vbVNjYWxlIiwiem9vbSIsIm9mZnNldCIsIl9nZXRDZW50ZXJPZmZzZXQiLCJjZW50ZXIiLCJfbXVsdGlwbHlCeSIsInN1YnRyYWN0Iiwic2V0VHJhbnNmb3JtIiwiVFJBTlNGT1JNIiwiZ2V0VHJhbnNsYXRlU3RyaW5nIiwiaGVhdExheWVyIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUtBLFNBQVNBLFlBQVdDLEdBQ2hCLEtBQU1DLGVBQWdCRixhQUFhLE1BQU8sSUFBSUEsWUFBV0MsRUFFekRDLE1BQUtDLFFBQVVGLEVBQTJCLGdCQUFYQSxHQUFzQkcsU0FBU0MsZUFBZUosR0FBVUEsRUFFdkZDLEtBQUtJLEtBQU9MLEVBQU9NLFdBQVcsTUFDOUJMLEtBQUtNLE9BQVNQLEVBQU9RLE1BQ3JCUCxLQUFLUSxRQUFVVCxFQUFPVSxPQUN0QlQsS0FBS1UsU0FBVSxFQUNmVixLQUFLVyxTQUFXWCxLQUFLWSxlQUNyQlosS0FBS2EsU0FaYSxtQkFBWEMsVUFBd0JBLE9BQU9DLFFBQVVqQixZQWVwREEsV0FBV2tCLFdBRVBDLGlCQUNJQyxNQUFPLHFCQUNQQyxJQUFRLDBCQUNSQyxHQUFPLDBCQUNQQyxJQUFRLDBCQUNSQyxNQUFPLHVCQUdYQyxLQUFNLFNBQVVBLEdBR1osTUFGQXZCLE1BQUthLE1BQVFVLEVBQ2J2QixLQUFLVSxTQUFVLEVBQ1JWLE1BSVh3QixJQUFLLFNBQVVDLEdBR1gsTUFGQXpCLE1BQUthLE1BQU1hLEtBQUtELEdBQ2hCekIsS0FBS1UsU0FBVSxFQUNSVixNQUdYMkIsTUFBTyxXQUVILE1BREEzQixNQUFLYSxTQUNFYixNQUdYWSxnQkFDSWdCLFVBQVcsVUFDWEMsSUFBSyxFQUNMQyxPQUFRLEdBQ1JDLEtBQU0sR0FDTkMsVUFD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Q2pDQyxFQUFTdEwsS0FBS2lILEtBQUtzRSxpQkFBaUJMLEVBQUVNLFFBQVFDLGFBQWFOLEdBQU9PLFNBQVMxTCxLQUFLaUgsS0FBS3lELGlCQUVyRnhFLEdBQUV3QyxRQUFRaUQsYUFDVnpGLEVBQUV3QyxRQUFRaUQsYUFBYTNMLEtBQUtDLFFBQVNxTCxFQUFRSCxHQUc3Q25MLEtBQUtDLFFBQVE2SSxNQUFNNUMsRUFBRXdDLFFBQVFrRCxXQUFhMUYsRUFBRXdDLFFBQVFtRCxtQkFBbUJQLEdBQVUsVUFBWUgsRUFBUSxPQUtqSGpGLEVBQUU0RixVQUFZLFNBQVV0RixFQUFTakUsR0FDN0IsTUFBTyxJQUFJMkQsR0FBRUMsVUFBVUssRUFBU2pFIiwiZmlsZSI6ImRpc3QvbGVhZmxldC1oZWF0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5cbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykgbW9kdWxlLmV4cG9ydHMgPSBzaW1wbGVoZWF0O1xuXG5mdW5jdGlvbiBzaW1wbGVoZWF0KGNhbnZhcykge1xuICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBzaW1wbGVoZWF0KSkgcmV0dXJuIG5ldyBzaW1wbGVoZWF0KGNhbnZhcyk7XG5cbiAgICB0aGlzLl9jYW52YXMgPSBjYW52YXMgPSB0eXBlb2YgY2FudmFzID09PSAnc3RyaW5nJyA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNhbnZhcykgOiBjYW52YXM7XG5cbiAgICB0aGlzLl9jdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICB0aGlzLl93aWR0aCA9IGNhbnZhcy53aWR0aDtcbiAgICB0aGlzLl9oZWlnaHQgPSBjYW52YXMuaGVpZ2h0O1xuICAgIHRoaXMuX3NvcnRlZCA9IGZhbHNlO1xuICAgIHRoaXMuX29wdGlvbnMgPSB0aGlzLmRlZmF1bHRPcHRpb25zXG4gICAgdGhpcy5fZGF0YSA9IFtdO1xufVxuXG5zaW1wbGVoZWF0LnByb3RvdHlwZSA9IHtcblxuICAgIGRlZmF1bHRHcmFkaWVudDoge1xuICAgICAgICAnMC4wJzogJ3JnYmEoMjA0LCAwLCAwLCAxKScsXG4gICAgICAgICcwLjI1JzogJ3JnYmEoMjU1LCAxNzgsIDAsIDAuNzUpJyxcbiAgICAgICAgJzAuNSc6ICdyZ2JhKDAsIDI0MywgMjU1LCAwLjI1KScsXG4gICAgICAgICcwLjc1JzogJ3JnYmEoMTgwLCAyNTUsIDAsIDAuNzUpJyxcbiAgICAgICAgJzEuMCc6ICdyZ2JhKDAsIDIxNCwgOTYsIDEpJ1xuICAgIH0sXG5cbiAgICBkYXRhOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB0aGlzLl9kYXRhID0gZGF0YTtcbiAgICAgICAgdGhpcy5fc29ydGVkID0gZmFsc2U7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cblxuICAgIGFkZDogZnVuY3Rpb24gKHBvaW50KSB7XG4gICAgICAgIHRoaXMuX2RhdGEucHVzaChwb2ludCk7XG4gICAgICAgIHRoaXMuX3NvcnRlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgY2xlYXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fZGF0YSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgZGVmYXVsdE9wdGlvbnM6IHtcbiAgICAgICAgYmxlbmRNb2RlOiAnb3ZlcmxheScsXG4gICAgICAgIG1heDogMSxcbiAgICAgICAgcmFkaXVzOiAyNSxcbiAgICAgICAgYmx1cjogMTUsXG4gICAgICAgIGdyYWRpZW50OiB7XG4gICAgICAgICAgICAnMC4wJzogJ3JnYmEoMjA0LCAwLCAwLCAxKScsXG4gICAgICAgICAgICAnMC4yNSc6ICdyZ2JhKDI1NSwgMTc4LCAwLCAwLjc1KScsXG4gICAgICAgICAgICAnMC41JzogJ3JnYmEoMCwgMjQzLCAyNTUsIDAuMjUpJyxcbiAgICAgICAgICAgICcwLjc1JzogJ3JnYmEoMTgwLCAyNTUsIDAsIDAuNzUpJyxcbiAgICAgICAgICAgICcxLjAnOiAncmdiYSgwLCAyMTQsIDk2LCAxKSdcbiAgICAgICAgfSxcbiAgICAgICAgY29sb3JpemU6IHRydWUsXG4gICAgICAgIGdyYXlzY2FsZToge1xuICAgICAgICAgICAgbmVnYXRpdmU6ICcjMDAwMDAwJyxcbiAgICAgICAgICAgIG5ldXRyYWw6ICcjODA4MDgwJyxcbiAgICAgICAgICAgIHBvc2l0aXZlOiAnI0ZGRkZGRicgICBcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRPcHRpb25zOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9vcHRpb25zLCBvcHRpb25zKTtcbiAgICAgICAgZGVsZXRlIHRoaXMuX2NpcmNsZXM7XG4gICAgICAgIGRlbGV0ZSB0aGlzLl9ncmFkO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgZ2V0T3B0aW9uczogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9vcHRpb25zKTtcbiAgICB9LFxuXG4gICAgaW5pdGlhbGl6ZUNpcmNsZUJydXNoZXM6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAvLyBhcnRpZmFjdHMgY2FuIGVtZXJnZSBpZiBmdWxsIGJsYWNrIGlzIHVzZWQgKHdoaXRlIGxpZ2h0IG92ZXJsYXkgZG9lcyBub3RoaW5nIHRvIGZ1bGwgYmxhY2spXG4gICAgICAgIHZhciBjb2xvcnMgPSB0aGlzLl9vcHRpb25zLmdyYXlzY2FsZVxuXG4gICAgICAgIHRoaXMuX2NpcmNsZXMgPSB7fVxuXG4gICAgICAgIFxuICAgICAgICB2YXIgcjIgPSB0aGlzLl9yID0gdGhpcy5fb3B0aW9ucy5yYWRpdXMgKyB0aGlzLl9vcHRpb25zLmJsdXI7XG5cbiAgICAgICAgZm9yICh2YXIgY29sb3JOYW1lIGluIGNvbG9ycykge1xuICAgICAgICAgICAgdmFyIGNvbG9yID0gY29sb3JzW2NvbG9yTmFtZV07XG4gICAgICAgICAgICB2YXIgY2FudmFzID0gdGhpcy5fY2lyY2xlc1tjb2xvck5hbWVdID0gdGhpcy5fY3JlYXRlQ2FudmFzKCk7XG4gICAgICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cbiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IGNhbnZhcy5oZWlnaHQgPSByMiAqIDI7XG5cbiAgICAgICAgICAgIGN0eC5zaGFkb3dPZmZzZXRYID0gY3R4LnNoYWRvd09mZnNldFkgPSByMiAqIDI7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gY29sb3JcbiAgICAgICAgICAgIGN0eC5zaGFkb3dDb2xvciA9IGNvbG9yO1xuICAgICAgICAgICAgY3R4LnNoYWRvd0JsdXIgPSB0aGlzLl9vcHRpb25zLmJsdXI7XG4gICAgICAgICAgICBcblxuICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgY3R4LmFyYygtcjIsIC1yMiwgdGhpcy5fb3B0aW9ucy5yYWRpdXMsIDAsIE1hdGguUEkgKiAyLCB0cnVlKTtcbiAgICAgICAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgICAgIGN0eC5maWxsKCk7XG5cbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9LFxuXG4gICAgcmVzaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3dpZHRoID0gdGhpcy5fY2FudmFzLndpZHRoO1xuICAgICAgICB0aGlzLl9oZWlnaHQgPSB0aGlzLl9jYW52YXMuaGVpZ2h0O1xuICAgIH0sXG5cbiAgICBpbml0aWFsaXplR3JhZGllbnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gY3JlYXRlIGEgMjU2eDEgZ3JhZGllbnQgdGhhdCB3ZSdsbCB1c2UgdG8gdHVybiBhIGdyYXlzY2FsZSBoZWF0bWFwIGludG8gYSBjb2xvcmVkIG9uZVxuICAgICAgICB2YXIgY2FudmFzID0gdGhpcy5fY3JlYXRlQ2FudmFzKCksXG4gICAgICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSxcbiAgICAgICAgICAgIGdyYWRpZW50ID0gY3R4LmNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDAsIDAsIDI1Nik7XG5cbiAgICAgICAgY2FudmFzLndpZHRoID0gMTtcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IDI1NjtcblxuICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuX29wdGlvbnMuZ3JhZGllbnQpIHtcbiAgICAgICAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgraSwgdGhpcy5fb3B0aW9ucy5ncmFkaWVudFtpXSk7XG4gICAgICAgIH1cblxuICAgICAgICBjdHguZmlsbFN0eWxlID0gZ3JhZGllbnQ7XG4gICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCAxLCAyNTYpO1xuXG4gICAgICAgIHRoaXMuX2dyYWQgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIDEsIDI1NikuZGF0YTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgZHJhdzogZnVuY3Rpb24gKG1pbk9wYWNpdHkpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9jaXJjbGVzKSB0aGlzLmluaXRpYWxpemVDaXJjbGVCcnVzaGVzKHRoaXMuZGVmYXVsdFJhZGl1cyk7XG4gICAgICAgIGlmICghdGhpcy5fZ3JhZCkgdGhpcy5pbml0aWFsaXplR3JhZGllbnQoKTtcbiAgICAgICAgaWYgKCF0aGlzLl9zb3J0ZWQpIHtcbiAgICAgICAgICAgIC8vIHNvcnQgc28gdGhhdCBwb3NpdGl2ZSBpcyBwYWludGVkIG92ZXIgbmV1dHJhIGlzIHBhaW50ZWQgb3ZlciBuZWdhdGl2ZS4gVW5mb3J0dW5hdGVseSB0aGVyZSBkb2VzIG5vdCBzZWVtIHRvIGJlIFxuICAgICAgICAgICAgLy8gYSBnbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gdGhhdCB0cmVhdHMgc291cmNlIGxheWVycyBlcXVhbGx5IHRvIHRoZSBsYXllciBvbiB0aGUgY2FudmFzLiBcbiAgICAgICAgICAgIC8vIExheWVyIGNvbG9yIHBhaW50ZWQgbGFzdCB3aWxsIGJlIHN0cm9uZ2VyXG4gICAgICAgICAgICB0aGlzLl9kYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsgXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFbM10gLSBiWzNdIFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLl9zb3J0ZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGN0eCA9IHRoaXMuX2N0eDtcbiAgICAgICAgY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IHRoaXMuX29wdGlvbnMuYmxlbmRNb2RlO1xuXG4gICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCk7XG4gICAgICAgIFxuICAgICAgICAvLyBkcmF3IGEgZ3JheXNjYWxlIGhlYXRtYXAgYnkgcHV0dGluZyBhIGJsdXJyZWQgY2lyY2xlIGF0IGVhY2ggZGF0YSBwb2ludFxuICAgICAgICBcbiAgICAgICAgdmFyIG5lZyA9IHRoaXMuX2NpcmNsZXMubmVnYXRpdmVcbiAgICAgICAgdmFyIHplcm8gPSB0aGlzLl9jaXJjbGVzLm5ldXRyYWxcbiAgICAgICAgdmFyIHBvcyA9IHRoaXMuX2NpcmNsZXMucG9zaXRpdmVcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX2RhdGEubGVuZ3RoLCBwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIHAgPSB0aGlzLl9kYXRhW2ldO1xuICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gTWF0aC5tYXgocFsyXSAvIHRoaXMuX29wdGlvbnMubWF4LCBtaW5PcGFjaXR5ID09PSB1bmRlZmluZWQgPyAwLjA1IDogbWluT3BhY2l0eSk7XG4gICAgICAgICAgICB2YXIgY2lyY2xlID0gcFszXSA+IDAgPyBwb3MgOiBwWzNdIDwgMCA/IG5lZyA6IHplcm9cbiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY2lyY2xlLCBwWzBdIC0gdGhpcy5fciwgcFsxXSAtIHRoaXMuX3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY29sb3JpemUgdGhlIGhlYXRtYXAsIHVzaW5nIG9wYWNpdHkgdmFsdWUgb2YgZWFjaCBwaXhlbCB0byBnZXQgdGhlIHJpZ2h0IGNvbG9yIGZyb20gb3VyIGdyYWRpZW50XG4gICAgICAgIHZhciBjb2xvcmVkID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KTtcbiAgICAgICAgdGhpcy5fY29sb3JpemUoY29sb3JlZC5kYXRhLCB0aGlzLl9ncmFkKTtcbiAgICAgICAgY3R4LnB1dEltYWdlRGF0YShjb2xvcmVkLCAwLCAwKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgXG4gICAgfSxcblxuICAgIF9jb2xvcml6ZTogZnVuY3Rpb24gKHBpeGVscywgZ3JhZGllbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuY29sb3JpemUpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwaXhlbHMubGVuZ3RoLCBqOyBpIDwgbGVuOyBpICs9IDQpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWxwaGEgPSBwaXhlbHNbaSArIDNdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGFscGhhKSB7XG4gICAgICAgICAgICAgICAgICAgIGogPSBwaXhlbHNbaV0gKiA0OyAvLyBnZXQgZ3JhZGllbnQgY29sb3IgZnJvbSByZWQgdmFsdWUsIChlLmcuIGdyYXlzY2FsZSB2YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgcGl4ZWxzW2ldID0gZ3JhZGllbnRbal07XG4gICAgICAgICAgICAgICAgICAgIHBpeGVsc1tpICsgMV0gPSBncmFkaWVudFtqICsgMV07XG4gICAgICAgICAgICAgICAgICAgIHBpeGVsc1tpICsgMl0gPSBncmFkaWVudFtqICsgMl07XG4gICAgICAgICAgICAgICAgICAgIC8vIHBpeGVsc1tpICsgM10gPSBncmFkaWVudFtqICsgM107IFxuICAgICAgICAgICAgICAgICAgICBwaXhlbHNbaSArIDNdID0gTWF0aC5mbG9vcigoZ3JhZGllbnRbaiArIDNdIC8gMjU2KSAqIChhbHBoYSAvIDI1NikgKiAyNTYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfY3JlYXRlQ2FudmFzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBjcmVhdGUgYSBuZXcgY2FudmFzIGluc3RhbmNlIGluIG5vZGUuanNcbiAgICAgICAgICAgIC8vIHRoZSBjYW52YXMgY2xhc3MgbmVlZHMgdG8gaGF2ZSBhIGRlZmF1bHQgY29uc3RydWN0b3Igd2l0aG91dCBhbnkgcGFyYW1ldGVyXG4gICAgICAgICAgICByZXR1cm4gbmV3IHRoaXMuX2NhbnZhcy5jb25zdHJ1Y3RvcigpO1xuICAgICAgICB9XG4gICAgfVxufTtcbiIsIid1c2Ugc3RyaWN0JztcblxuTC5IZWF0TGF5ZXIgPSAoTC5MYXllciA/IEwuTGF5ZXIgOiBMLkNsYXNzKS5leHRlbmQoe1xuXG4gICAgLy8gb3B0aW9uczoge1xuICAgIC8vICAgICBtaW5PcGFjaXR5OiAwLjA1LFxuICAgIC8vICAgICBtYXhab29tOiAxOCxcbiAgICAvLyAgICAgcmFkaXVzOiAyNSxcbiAgICAvLyAgICAgYmx1cjogMTUsXG4gICAgLy8gICAgIG1heDogMS4wXG4gICAgLy8gfSxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChsYXRsbmdzLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuX2xhdGxuZ3MgPSBsYXRsbmdzO1xuICAgICAgICBMLnNldE9wdGlvbnModGhpcywgb3B0aW9ucyk7XG4gICAgfSxcblxuICAgIHNldExhdExuZ3M6IGZ1bmN0aW9uIChsYXRsbmdzKSB7XG4gICAgICAgIHRoaXMuX2xhdGxuZ3MgPSBsYXRsbmdzO1xuICAgICAgICByZXR1cm4gdGhpcy5yZWRyYXcoKTtcbiAgICB9LFxuXG4gICAgYWRkTGF0TG5nOiBmdW5jdGlvbiAobGF0bG5nKSB7XG4gICAgICAgIHRoaXMuX2xhdGxuZ3MucHVzaChsYXRsbmcpO1xuICAgICAgICByZXR1cm4gdGhpcy5yZWRyYXcoKTtcbiAgICB9LFxuXG4gICAgc2V0T3B0aW9uczogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgTC5zZXRPcHRpb25zKHRoaXMsIG9wdGlvbnMpO1xuICAgICAgICBpZiAodGhpcy5faGVhdCkge1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlT3B0aW9ucygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnJlZHJhdygpO1xuICAgIH0sXG5cbiAgICByZWRyYXc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2hlYXQgJiYgIXRoaXMuX2ZyYW1lICYmIHRoaXMuX21hcCAmJiAhdGhpcy5fbWFwLl9hbmltYXRpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZyYW1lID0gTC5VdGlsLnJlcXVlc3RBbmltRnJhbWUodGhpcy5fcmVkcmF3LCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgb25BZGQ6IGZ1bmN0aW9uIChtYXApIHtcbiAgICAgICAgdGhpcy5fbWFwID0gbWFwO1xuXG4gICAgICAgIGlmICghdGhpcy5fY2FudmFzKSB7XG4gICAgICAgICAgICB0aGlzLl9pbml0Q2FudmFzKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnBhbmUpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0UGFuZSgpLmFwcGVuZENoaWxkKHRoaXMuX2NhbnZhcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtYXAuX3BhbmVzLm92ZXJsYXlQYW5lLmFwcGVuZENoaWxkKHRoaXMuX2NhbnZhcyk7XG4gICAgICAgIH1cblxuICAgICAgICBtYXAub24oJ21vdmVlbmQnLCB0aGlzLl9yZXNldCwgdGhpcyk7XG5cbiAgICAgICAgaWYgKG1hcC5vcHRpb25zLnpvb21BbmltYXRpb24gJiYgTC5Ccm93c2VyLmFueTNkKSB7XG4gICAgICAgICAgICBtYXAub24oJ3pvb21hbmltJywgdGhpcy5fYW5pbWF0ZVpvb20sIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fcmVzZXQoKTtcbiAgICB9LFxuXG4gICAgb25SZW1vdmU6IGZ1bmN0aW9uIChtYXApIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5wYW5lKSB7XG4gICAgICAgICAgICB0aGlzLmdldFBhbmUoKS5yZW1vdmVDaGlsZCh0aGlzLl9jYW52YXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWFwLmdldFBhbmVzKCkub3ZlcmxheVBhbmUucmVtb3ZlQ2hpbGQodGhpcy5fY2FudmFzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG1hcC5vZmYoJ21vdmVlbmQnLCB0aGlzLl9yZXNldCwgdGhpcyk7XG5cbiAgICAgICAgaWYgKG1hcC5vcHRpb25zLnpvb21BbmltYXRpb24pIHtcbiAgICAgICAgICAgIG1hcC5vZmYoJ3pvb21hbmltJywgdGhpcy5fYW5pbWF0ZVpvb20sIHRoaXMpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGFkZFRvOiBmdW5jdGlvbiAobWFwKSB7XG4gICAgICAgIG1hcC5hZGRMYXllcih0aGlzKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIF9pbml0Q2FudmFzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjYW52YXMgPSB0aGlzLl9jYW52YXMgPSBMLkRvbVV0aWwuY3JlYXRlKCdjYW52YXMnLCAnbGVhZmxldC1oZWF0bWFwLWxheWVyIGxlYWZsZXQtbGF5ZXInKTtcblxuICAgICAgICB2YXIgb3JpZ2luUHJvcCA9IEwuRG9tVXRpbC50ZXN0UHJvcChbJ3RyYW5zZm9ybU9yaWdpbicsICdXZWJraXRUcmFuc2Zvcm1PcmlnaW4nLCAnbXNUcmFuc2Zvcm1PcmlnaW4nXSk7XG4gICAgICAgIGNhbnZhcy5zdHlsZVtvcmlnaW5Qcm9wXSA9ICc1MCUgNTAlJztcblxuICAgICAgICB2YXIgc2l6ZSA9IHRoaXMuX21hcC5nZXRTaXplKCk7XG4gICAgICAgIGNhbnZhcy53aWR0aCAgPSBzaXplLng7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBzaXplLnk7XG5cbiAgICAgICAgdmFyIGFuaW1hdGVkID0gdGhpcy5fbWFwLm9wdGlvbnMuem9vbUFuaW1hdGlvbiAmJiBMLkJyb3dzZXIuYW55M2Q7XG4gICAgICAgIEwuRG9tVXRpbC5hZGRDbGFzcyhjYW52YXMsICdsZWFmbGV0LXpvb20tJyArIChhbmltYXRlZCA/ICdhbmltYXRlZCcgOiAnaGlkZScpKTtcblxuICAgICAgICB0aGlzLl9oZWF0ID0gc2ltcGxlaGVhdChjYW52YXMpO1xuICAgICAgICB0aGlzLl91cGRhdGVPcHRpb25zKCk7XG4gICAgfSxcblxuICAgIF91cGRhdGVPcHRpb25zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuX2hlYXQpXG4gICAgICAgIHRoaXMuX2hlYXQuc2V0T3B0aW9ucyh0aGlzLm9wdGlvbnMpXG4gICAgfSxcblxuICAgIF9yZXNldDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG9wTGVmdCA9IHRoaXMuX21hcC5jb250YWluZXJQb2ludFRvTGF5ZXJQb2ludChbMCwgMF0pO1xuICAgICAgICBMLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fY2FudmFzLCB0b3BMZWZ0KTtcblxuICAgICAgICB2YXIgc2l6ZSA9IHRoaXMuX21hcC5nZXRTaXplKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuX2hlYXQuX3dpZHRoICE9PSBzaXplLngpIHtcbiAgICAgICAgICAgIHRoaXMuX2NhbnZhcy53aWR0aCA9IHRoaXMuX2hlYXQuX3dpZHRoICA9IHNpemUueDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5faGVhdC5faGVpZ2h0ICE9PSBzaXplLnkpIHtcbiAgICAgICAgICAgIHRoaXMuX2NhbnZhcy5oZWlnaHQgPSB0aGlzLl9oZWF0Ll9oZWlnaHQgPSBzaXplLnk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9yZWRyYXcoKTtcbiAgICB9LFxuXG4gICAgX3JlZHJhdzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuX21hcCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBkYXRhID0gW10sXG4gICAgICAgICAgICByID0gdGhpcy5faGVhdC5fcixcbiAgICAgICAgICAgIHNpemUgPSB0aGlzLl9tYXAuZ2V0U2l6ZSgpLFxuICAgICAgICAgICAgYm91bmRzID0gbmV3IEwuQm91bmRzKFxuICAgICAgICAgICAgICAgIEwucG9pbnQoWy1yLCAtcl0pLFxuICAgICAgICAgICAgICAgIHNpemUuYWRkKFtyLCByXSkpLFxuXG4gICAgICAgICAgICBtYXggPSB0aGlzLm9wdGlvbnMubWF4ID09PSB1bmRlZmluZWQgPyAxIDogdGhpcy5vcHRpb25zLm1heCxcbiAgICAgICAgICAgIG1heFpvb20gPSB0aGlzLm9wdGlvbnMubWF4Wm9vbSA9PT0gdW5kZWZpbmVkID8gdGhpcy5fbWFwLmdldE1heFpvb20oKSA6IHRoaXMub3B0aW9ucy5tYXhab29tLFxuICAgICAgICAgICAgdiA9IDEgLyBNYXRoLnBvdygyLCBNYXRoLm1heCgwLCBNYXRoLm1pbihtYXhab29tIC0gdGhpcy5fbWFwLmdldFpvb20oKSwgMTIpKSksXG4gICAgICAgICAgICBjZWxsU2l6ZSA9IHIgLyAyLFxuICAgICAgICAgICAgZ3JpZCA9IFtdLFxuICAgICAgICAgICAgcGFuZVBvcyA9IHRoaXMuX21hcC5fZ2V0TWFwUGFuZVBvcygpLFxuICAgICAgICAgICAgb2Zmc2V0WCA9IHBhbmVQb3MueCAlIGNlbGxTaXplLFxuICAgICAgICAgICAgb2Zmc2V0WSA9IHBhbmVQb3MueSAlIGNlbGxTaXplLFxuICAgICAgICAgICAgaSwgbGVuLCBwLCBjZWxsLCB4LCB5LCBqLCBsZW4yLCBrLCBsYXllcjtcblxuICAgICAgICAvLyBjb25zb2xlLnRpbWUoJ3Byb2Nlc3MnKTtcbiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gdGhpcy5fbGF0bG5ncy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgcCA9IHRoaXMuX21hcC5sYXRMbmdUb0NvbnRhaW5lclBvaW50KHRoaXMuX2xhdGxuZ3NbaV0pO1xuICAgICAgICAgICAgaWYgKGJvdW5kcy5jb250YWlucyhwKSkge1xuICAgICAgICAgICAgICAgIHggPSBNYXRoLmZsb29yKChwLnggLSBvZmZzZXRYKSAvIGNlbGxTaXplKSArIDI7XG4gICAgICAgICAgICAgICAgeSA9IE1hdGguZmxvb3IoKHAueSAtIG9mZnNldFkpIC8gY2VsbFNpemUpICsgMjtcblxuICAgICAgICAgICAgICAgIHZhciBhbHQgPVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9sYXRsbmdzW2ldLmFsdCAhPT0gdW5kZWZpbmVkID8gdGhpcy5fbGF0bG5nc1tpXS5hbHQgOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9sYXRsbmdzW2ldWzJdICE9PSB1bmRlZmluZWQgPyArdGhpcy5fbGF0bG5nc1tpXVsyXSA6IDE7XG4gICAgICAgICAgICAgICAgbGF5ZXIgPSAodGhpcy5fbGF0bG5nc1tpXVszXSA9PT0gdW5kZWZpbmVkID8gMSA6IHRoaXMuX2xhdGxuZ3NbaV1bM10pICsgMTtcbiAgICAgICAgICAgICAgICBrID0gYWx0ICogdjtcblxuICAgICAgICAgICAgICAgIGdyaWRbeV0gPSBncmlkW3ldIHx8IFtdO1xuICAgICAgICAgICAgICAgIGdyaWRbeV1beF0gPSBncmlkW3ldW3hdIHx8IFtdO1xuICAgICAgICAgICAgICAgIGNlbGwgPSBncmlkW3ldW3hdW2xheWVyXTtcblxuICAgICAgICAgICAgICAgIGlmICghY2VsbCkge1xuICAgICAgICAgICAgICAgICAgICBncmlkW3ldW3hdW2xheWVyXSA9IFtwLngsIHAueSwgaywgbGF5ZXJdO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbFswXSA9IChjZWxsWzBdICogY2VsbFsyXSArIHAueCAqIGspIC8gKGNlbGxbMl0gKyBrKTsgLy8geFxuICAgICAgICAgICAgICAgICAgICBjZWxsWzFdID0gKGNlbGxbMV0gKiBjZWxsWzJdICsgcC55ICogaykgLyAoY2VsbFsyXSArIGspOyAvLyB5XG4gICAgICAgICAgICAgICAgICAgIGNlbGxbMl0gKz0gazsgLy8gY3VtdWxhdGVkIGludGVuc2l0eSB2YWx1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBncmlkLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoZ3JpZFtpXSkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwLCBsZW4yID0gZ3JpZFtpXS5sZW5ndGg7IGogPCBsZW4yOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdyaWRbaV1bal0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwLCBsZW4zID0gZ3JpZFtpXVtqXS5sZW5ndGg7IGsgPCBsZW4zOyBrKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsID0gZ3JpZFtpXVtqXVtrXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2VsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2goW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjZWxsWzBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgucm91bmQoY2VsbFsxXSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLm1pbihjZWxsWzJdLCBtYXgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbFszXSAtIDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIGNvbnNvbGUudGltZUVuZCgncHJvY2VzcycpO1xuICAgICAgICAvLyBjb25zb2xlLnRpbWUoJ2RyYXcgJyArIGRhdGEubGVuZ3RoKTtcbiAgICAgICAgdGhpcy5faGVhdC5kYXRhKGRhdGEpLmRyYXcodGhpcy5vcHRpb25zLm1pbk9wYWNpdHkpO1xuICAgICAgICAvLyBjb25zb2xlLnRpbWVFbmQoJ2RyYXcgJyArIGRhdGEubGVuZ3RoKTtcblxuICAgICAgICB0aGlzLl9mcmFtZSA9IG51bGw7XG4gICAgfSxcblxuICAgIF9hbmltYXRlWm9vbTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIHNjYWxlID0gdGhpcy5fbWFwLmdldFpvb21TY2FsZShlLnpvb20pLFxuICAgICAgICAgICAgb2Zmc2V0ID0gdGhpcy5fbWFwLl9nZXRDZW50ZXJPZmZzZXQoZS5jZW50ZXIpLl9tdWx0aXBseUJ5KC1zY2FsZSkuc3VidHJhY3QodGhpcy5fbWFwLl9nZXRNYXBQYW5lUG9zKCkpO1xuXG4gICAgICAgIGlmIChMLkRvbVV0aWwuc2V0VHJhbnNmb3JtKSB7XG4gICAgICAgICAgICBMLkRvbVV0aWwuc2V0VHJhbnNmb3JtKHRoaXMuX2NhbnZhcywgb2Zmc2V0LCBzY2FsZSk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2NhbnZhcy5zdHlsZVtMLkRvbVV0aWwuVFJBTlNGT1JNXSA9IEwuRG9tVXRpbC5nZXRUcmFuc2xhdGVTdHJpbmcob2Zmc2V0KSArICcgc2NhbGUoJyArIHNjYWxlICsgJyknO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbkwuaGVhdExheWVyID0gZnVuY3Rpb24gKGxhdGxuZ3MsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4gbmV3IEwuSGVhdExheWVyKGxhdGxuZ3MsIG9wdGlvbnMpO1xufTtcbiJdfQ==